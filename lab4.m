% ========================================================================
% ПРАКТИЧНА РОБОТА №4 - ВАРІАНТ 2
% Розв'язування СЛАР методами Крамера та матричним
% ========================================================================
% Система рівнянь:
% 3x₁ + 2x₂ - 5x₃ = -1
% 2x₁ - x₂ + 3x₃ = 13
% x₁ + 2x₂ - x₃ = 9
% ========================================================================

clear all;
clc;
close all;

fprintf('\n');
fprintf('╔════════════════════════════════════════════════════════════════╗\n');
fprintf('║        ПРАКТИЧНА РОБОТА №4 - ВАРІАНТ 2                        ║\n');
fprintf('║   Розв''язування СЛАР методами Крамера та матричним            ║\n');
fprintf('╚════════════════════════════════════════════════════════════════╝\n');
fprintf('\n');

% ========================================================================
% КРОК 1: ВВЕДЕННЯ ДАНИХ
% ========================================================================
fprintf('КРОК 1: ВВЕДЕННЯ ДАНИХ\n');
fprintf('──────────────────────────────────────────────────────────────────\n');

% Матриця системи A
A = [3  2 -5;
     2 -1  3;
     1  2 -1];

% Вектор вільних членів B
B = [-1; 13; 9];

fprintf('Система рівнянь:\n');
fprintf('  3x₁ + 2x₂ - 5x₃ = -1\n');
fprintf('  2x₁ - x₂ + 3x₃ = 13\n');
fprintf('  x₁ + 2x₂ - x₃ = 9\n');
fprintf('\n');

fprintf('Матриця системи A:\n');
disp(A);

fprintf('Вектор вільних членів B:\n');
disp(B);

% ========================================================================
% КРОК 2: ПЕРЕВІРКА СУМІСНОСТІ СИСТЕМИ
% ========================================================================
fprintf('\n');
fprintf('╔════════════════════════════════════════════════════════════════╗\n');
fprintf('║ КРОК 2: ПЕРЕВІРКА СУМІСНОСТІ СИСТЕМИ                          ║\n');
fprintf('╚════════════════════════════════════════════════════════════════╝\n');
fprintf('\n');

% Побудова розширеної матриці
C = [A B];
fprintf('Розширена матриця C = [A | B]:\n');
disp(C);

% Знаходження рангів
r1 = rank(A);
r2 = rank(C);

fprintf('Ранг матриці A: r(A) = %d\n', r1);
fprintf('Ранг розширеної матриці C: r(C) = %d\n', r2);
fprintf('\n');

if r1 == r2
    fprintf('✓ ВИСНОВОК: r(A) = r(C) = %d\n', r1);
    fprintf('✓ Система є СУМІСНОЮ і має єдиний розв''язок\n');
    fprintf('\n');
else
    fprintf('✗ ВИСНОВОК: r(A) ≠ r(C)\n');
    fprintf('✗ Система є НЕСУМІСНОЮ\n');
    fprintf('\n');
    error('Система несумісна - розв''язок неможливий');
end

% ========================================================================
% КРОК 3: РОЗВ'ЯЗУВАННЯ МЕТОДОМ КРАМЕРА
% ========================================================================
fprintf('\n');
fprintf('╔════════════════════════════════════════════════════════════════╗\n');
fprintf('║ КРОК 3: РОЗВ''ЯЗУВАННЯ МЕТОДОМ КРАМЕРА                         ║\n');
fprintf('╚════════════════════════════════════════════════════════════════╝\n');
fprintf('\n');

% Обчислення визначника матриці системи
d = det(A);
fprintf('Визначник матриці системи:\n');
fprintf('  Δ = det(A) = %.4f\n', d);
fprintf('\n');

if abs(d) < 1e-10
    error('✗ Визначник дорівнює нулю - метод Крамера не застосовний');
end

% Виділення стовпців матриці А
A1 = A(:,1);
A2 = A(:,2);
A3 = A(:,3);

% Побудова матриць для обчислення невідомих
D1 = [B A2 A3];
D2 = [A1 B A3];
D3 = [A1 A2 B];

fprintf('Матриці для обчислення невідомих:\n\n');

fprintf('D₁ (B замінює 1-й стовпець):\n');
disp(D1);

fprintf('D₂ (B замінює 2-й стовпець):\n');
disp(D2);

fprintf('D₃ (B замінює 3-й стовпець):\n');
disp(D3);

% Обчислення визначників
d1 = det(D1);
d2 = det(D2);
d3 = det(D3);

fprintf('Визначники матриць невідомих:\n');
fprintf('  Δ₁ = det(D₁) = %.4f\n', d1);
fprintf('  Δ₂ = det(D₂) = %.4f\n', d2);
fprintf('  Δ₃ = det(D₃) = %.4f\n', d3);
fprintf('\n');

% Знаходження коренів за формулами Крамера
X_kramer = [d1/d; d2/d; d3/d];

fprintf('───────────────────────────────────────\n');
fprintf('  РОЗВ''ЯЗОК МЕТОДОМ КРАМЕРА:\n');
fprintf('───────────────────────────────────────\n');
fprintf('  x₁ = Δ₁/Δ = %.4f / %.4f = %.6f\n', d1, d, X_kramer(1));
fprintf('  x₂ = Δ₂/Δ = %.4f / %.4f = %.6f\n', d2, d, X_kramer(2));
fprintf('  x₃ = Δ₃/Δ = %.4f / %.4f = %.6f\n', d3, d, X_kramer(3));
fprintf('───────────────────────────────────────\n');
fprintf('\n');

% Перевірка розв'язку
B_check_kramer = A * X_kramer;
fprintf('Перевірка (A * X):\n');
disp(B_check_kramer);
fprintf('Очікувалось B:\n');
disp(B);

error_kramer = norm(B - B_check_kramer);
fprintf('Похибка: %.10e\n', error_kramer);

if error_kramer < 1e-6
    fprintf('✓ Перевірка ПРОЙДЕНА (похибка < 10⁻⁶)\n');
else
    fprintf('✗ Перевірка НЕ ПРОЙДЕНА\n');
end
fprintf('\n');

% ========================================================================
% КРОК 4: РОЗВ'ЯЗУВАННЯ МАТРИЧНИМ МЕТОДОМ
% ========================================================================
fprintf('\n');
fprintf('╔════════════════════════════════════════════════════════════════╗\n');
fprintf('║ КРОК 4: РОЗВ''ЯЗУВАННЯ МАТРИЧНИМ МЕТОДОМ                       ║\n');
fprintf('╚════════════════════════════════════════════════════════════════╝\n');
fprintf('\n');

% Знаходження оберненої матриці
A_inv = inv(A);
fprintf('Обернена матриця A⁻¹:\n');
disp(A_inv);

% Знаходження розв'язку за формулою X = A⁻¹ * B
X_matrix = A_inv * B;

fprintf('───────────────────────────────────────\n');
fprintf('  РОЗВ''ЯЗОК МАТРИЧНИМ МЕТОДОМ:\n');
fprintf('───────────────────────────────────────\n');
fprintf('  X = A⁻¹ * B:\n');
fprintf('  x₁ = %.6f\n', X_matrix(1));
fprintf('  x₂ = %.6f\n', X_matrix(2));
fprintf('  x₃ = %.6f\n', X_matrix(3));
fprintf('───────────────────────────────────────\n');
fprintf('\n');

% Перевірка розв'язку
B_check_matrix = A * X_matrix;
fprintf('Перевірка (A * X):\n');
disp(B_check_matrix);
fprintf('Очікувалось B:\n');
disp(B);

error_matrix = norm(B - B_check_matrix);
fprintf('Похибка: %.10e\n', error_matrix);

if error_matrix < 1e-6
    fprintf('✓ Перевірка ПРОЙДЕНА (похибка < 10⁻⁶)\n');
else
    fprintf('✗ Перевірка НЕ ПРОЙДЕНА\n');
end
fprintf('\n');

% ========================================================================
% КРОК 5: ПОРІВНЯННЯ РЕЗУЛЬТАТІВ
% ========================================================================
fprintf('\n');
fprintf('╔════════════════════════════════════════════════════════════════╗\n');
fprintf('║ КРОК 5: ПОРІВНЯННЯ РЕЗУЛЬТАТІВ                                 ║\n');
fprintf('╚════════════════════════════════════════════════════════════════╝\n');
fprintf('\n');

diff_methods = norm(X_kramer - X_matrix);
fprintf('Різниця між методами: %.10e\n', diff_methods);

if diff_methods < 1e-6
    fprintf('✓ Обидва методи дали ІДЕНТИЧНІ результати\n');
else
    fprintf('⚠ Є незначна розбіжність між методами\n');
end
fprintf('\n');

% Порівняльна таблиця
fprintf('┌─────────┬──────────────┬──────────────┬─────────────┐\n');
fprintf('│ Змінна  │    Крамера   │   Матричний  │  Різниця    │\n');
fprintf('├─────────┼──────────────┼──────────────┼─────────────┤\n');
fprintf('│   x₁    │  %10.6f  │  %10.6f  │  %.3e  │\n', X_kramer(1), X_matrix(1), abs(X_kramer(1)-X_matrix(1)));
fprintf('│   x₂    │  %10.6f  │  %10.6f  │  %.3e  │\n', X_kramer(2), X_matrix(2), abs(X_kramer(2)-X_matrix(2)));
fprintf('│   x₃    │  %10.6f  │  %10.6f  │  %.3e  │\n', X_kramer(3), X_matrix(3), abs(X_kramer(3)-X_matrix(3)));
fprintf('└─────────┴──────────────┴──────────────┴─────────────┘\n');
fprintf('\n');

% ========================================================================
% КРОК 6: ГРАФІЧНЕ ПРЕДСТАВЛЕННЯ
% ========================================================================
fprintf('\n');
fprintf('╔════════════════════════════════════════════════════════════════╗\n');
fprintf('║ КРОК 6: ПОБУДОВА ГРАФІКІВ                                      ║\n');
fprintf('╚════════════════════════════════════════════════════════════════╝\n');
fprintf('\n');

try
    figure('Position', [50, 50, 1400, 900]);
    
    % Підграфік 1: Порівняння розв'язків
    subplot(2,3,1);
    bar_data = [X_kramer'; X_matrix'];
    bar(bar_data);
    set(gca, 'XTickLabel', {'Крамера', 'Матричний'});
    legend('x_1', 'x_2', 'x_3', 'Location', 'best');
    title('Порівняння розв''язків', 'FontSize', 12, 'FontWeight', 'bold');
    ylabel('Значення');
    grid on;
    
    % Підграфік 2: Графік коренів
    subplot(2,3,2);
    plot(1:3, X_kramer, 'ro-', 'LineWidth', 2, 'MarkerSize', 10);
    hold on;
    plot(1:3, X_matrix, 'bs--', 'LineWidth', 2, 'MarkerSize', 10);
    set(gca, 'XTick', 1:3, 'XTickLabel', {'x_1', 'x_2', 'x_3'});
    legend('Крамера', 'Матричний', 'Location', 'best');
    title('Значення невідомих', 'FontSize', 12, 'FontWeight', 'bold');
    ylabel('Значення');
    grid on;
    
    % Підграфік 3: Перевірка Крамера
    subplot(2,3,3);
    bar([B, B_check_kramer]);
    set(gca, 'XTickLabel', {'b_1', 'b_2', 'b_3'});
    legend('Очікуване', 'Обчислене', 'Location', 'best');
    title('Перевірка: Крамера', 'FontSize', 12, 'FontWeight', 'bold');
    ylabel('Значення');
    grid on;
    
    % Підграфік 4: Перевірка матричний
    subplot(2,3,4);
    bar([B, B_check_matrix]);
    set(gca, 'XTickLabel', {'b_1', 'b_2', 'b_3'});
    legend('Очікуване', 'Обчислене', 'Location', 'best');
    title('Перевірка: Матричний', 'FontSize', 12, 'FontWeight', 'bold');
    ylabel('Значення');
    grid on;
    
    % Підграфік 5: Матриця A
    subplot(2,3,5);
    imagesc(A);
    colorbar;
    title('Матриця A', 'FontSize', 12, 'FontWeight', 'bold');
    set(gca, 'XTick', 1:3, 'YTick', 1:3);
    xlabel('Стовпці');
    ylabel('Рядки');
    
    % Підграфік 6: Похибки
    subplot(2,3,6);
    bar([error_kramer, error_matrix]);
    set(gca, 'XTickLabel', {'Крамера', 'Матричний'});
    title('Похибки обчислень', 'FontSize', 12, 'FontWeight', 'bold');
    ylabel('Похибка');
    grid on;
    
    % Загальний заголовок
    annotation('textbox', [0.3, 0.95, 0.4, 0.04], ...
               'String', 'ПРАКТИЧНА РОБОТА №4 - ВАРІАНТ 2', ...
               'EdgeColor', 'none', 'FontSize', 16, 'FontWeight', 'bold', ...
               'HorizontalAlignment', 'center');
    
    % Збереження графіка
    print -dpng -r300 lab4_result.png
    fprintf('✓ Графік збережено як: lab4_result.png\n');
    
catch err
    fprintf('⚠ Помилка при побудові графіків: %s\n', err.message);
    fprintf('  (Це не впливає на правильність розв''язку)\n');
end

fprintf('\n');

% ========================================================================
% ВИСНОВКИ
% ========================================================================
fprintf('\n');
fprintf('╔════════════════════════════════════════════════════════════════╗\n');
fprintf('║ ВИСНОВКИ                                                       ║\n');
fprintf('╚════════════════════════════════════════════════════════════════╝\n');
fprintf('\n');
fprintf('1. Система лінійних алгебраїчних рівнянь є СУМІСНОЮ\n');
fprintf('   (ранг матриці A дорівнює рангу розширеної матриці C)\n');
fprintf('\n');
fprintf('2. Знайдено єдиний розв''язок системи:\n');
fprintf('   x₁ = %.6f\n', X_matrix(1));
fprintf('   x₂ = %.6f\n', X_matrix(2));
fprintf('   x₃ = %.6f\n', X_matrix(3));
fprintf('\n');
fprintf('3. Метод Крамера:\n');
fprintf('   - Використовує обчислення визначників\n');
fprintf('   - Похибка: %.3e\n', error_kramer);
fprintf('\n');
fprintf('4. Матричний метод:\n');
fprintf('   - Використовує обернену матрицю\n');
fprintf('   - Похибка: %.3e\n', error_matrix);
fprintf('\n');
fprintf('5. Обидва методи дали ідентичні результати\n');
fprintf('\n');
fprintf('6. Перевірка підтверджує правильність розв''язку\n');
fprintf('\n');
fprintf('╚════════════════════════════════════════════════════════════════╝\n');
fprintf('\n');